<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recommend Food</title>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!----======== CSS ======== -->
    <link rel="stylesheet" href="css/main.css" />
    <!----===== Iconscout CSS ===== -->
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.0/css/line.css"
    />
    <link rel="stylesheet" href="src/calendar-gc.css" />
    <style>
      html,
      body {
        margin: 0;
        overflow-x: hidden;
      }
      ul {
        list-style: none;
        margin-left: -2rem;
      }
      ul a {
        text-decoration: none;
      }
      .upload2 {
        padding: 20px;
      }
      .upload2 p {
        margin-top: 10px;
      }

      .recom-container {
        display: flex;
        justify-content: center; /* 수평 중앙 정렬 */
        align-items: center; /* 수직 중앙 정렬 */
        min-height: 60vh; /* 화면 중앙에 위치하도록 높이 설정 */
      }

      .recom .card {
        max-width: 800px; /* 카드의 최대 너비 설정 */
        width: 100%;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="logo-name">
        <div class="logo-image">
          <img src="img/logo.jpg" alt="" />
        </div>
        <span class="logo_name">Foodnutri</span>
      </div>
      <div class="menu-items">
        <ul class="nav-links">
          <li>
            <a href="main.html">
              <i class="uil uil-estate"></i>
              <span class="link-name">Home</span>
            </a>
          </li>
          <li>
            <a href="uppicture.html">
              <i class="uil uil-image-upload"></i>
              <span class="link-name">Upload Picture</span>
            </a>
          </li>
          <li>
            <a href="recomfood.html">
              <i class="uil uil-utensils-alt"></i>
              <span class="link-name">Similar Food Recommendation</span>
            </a>
          </li>
          <li>
            <a href="recomfooduser.html">
              <i class="uil uil-chat-bubble-user"></i>
              <span class="link-name">User Based Recommendation</span>
            </a>
          </li>
        </ul>
        <ul class="logout-mode">
          <div class="mode-toggle"></div>
        </ul>
      </div>
    </nav>

    <section class="dashboard">
      <div class="top">
        <i class="uil uil-bars sidebar-toggle"></i>
        <div class="search-box"></div>
        <div class="dropdown">
          <a
            href="#"
            class="dropdown-toggle"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <img src="img/profile.jpg" alt="" />
          </a>
          <ul class="dropdown-menu">
            <li>
              <a class="dropdown-item" href="updateprof1.html"
                ><i class="uil uil-user"></i> Update Profile</a
              >
            </li>
            <li>
              <a class="dropdown-item" href="login.html"
                ><i class="uil uil-sign-out-alt"></i> Logout</a
              >
            </li>
          </ul>
        </div>
      </div>

      <h3 class="mt-5 text-start">Similar Food Recommendation</h3>

      <div class="upload2">
        <form id="uploadForm">
          <label for="file" class="labelFile">
            <span>
              <svg
                viewBox="0 0 184.69 184.69"
                xmlns="http://www.w3.org/2000/svg"
                width="60px"
                height="60px"
              >
                <g>
                  <path
                    d="M149.968,50.186c-8.017-14.308-23.796-22.515-40.717-19.813C102.609,16.43,88.713,7.576,73.087,7.576c-22.117,0-40.112,17.994-40.112,40.115c0,0.913,0.036,1.854,0.118,2.834C14.004,54.875,0,72.11,0,91.959c0,23.456,19.082,42.535,42.538,42.535h33.623v-7.025H42.538c-19.583,0-35.509-15.929-35.509-35.509c0-17.526,13.084-32.621,30.442-35.105c0.931-0.132,1.768-0.633,2.326-1.392c0.555-0.755,0.795-1.704,0.644-2.63c-0.297-1.904-0.447-3.582-0.447-5.139c0-18.249,14.852-33.094,33.094-33.094c13.703,0,25.789,8.26,30.803,21.04c0.63,1.621,2.351,2.534,4.058,2.14c15.425-3.568,29.919,3.883,36.604,17.168c0.508,1.027,1.503,1.736,2.641,1.897c17.368,2.473,30.481,17.569,30.481,35.112c0,19.58-15.937,35.509-35.52,35.509H97.391v7.025h44.761c23.459,0,42.538-19.079,42.538-42.535C184.69,71.545,169.884,53.901,149.968,50.186z"
                    fill="#010002"
                  ></path>
                  <path
                    d="M108.586,90.201c1.406-1.403,1.406-3.672,0-5.075L88.541,65.078c-0.701-0.698-1.614-1.045-2.534-1.045l-0.064,0.011c-0.018,0-0.036-0.011-0.054-0.011c-0.931,0-1.85,0.361-2.534,1.045L63.31,85.127c-1.403,1.403-1.403,3.672,0,5.075c1.403,1.406,3.672,1.406,5.075,0L82.296,76.29v97.227c0,1.99,1.603,3.597,3.593,3.597c1.979,0,3.59-1.607,3.59-3.597V76.165l14.033,14.036C104.91,91.608,107.183,91.608,108.586,90.201z"
                    fill="#010002"
                  ></path>
                </g>
              </svg>
            </span>
            <p>
              drag and drop your picture here, and the maximum size is 500MB
            </p>
          </label>
          <input class="input" id="file" type="file" name="image" required />
          <button type="submit" class="btn btn-secondary btn-sm">Send</button>
        </form>
      </div>

      <div class="recom-container">
        <div class="recom mt-3" id="recommendationResult"></div>
      </div>
    </section>

    <script>
      document
        .getElementById("uploadForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const fileInput = document.getElementById("file");
          const formData = new FormData();
          formData.append("image", fileInput.files[0]);

          try {
            const response = await fetch(
              "http://127.0.0.1:8000/api/foods/similar",
              {
                method: "POST",
                body: formData,
              }
            );

            if (!response.ok) {
              throw new Error("Failed to upload image");
            }

            const result = await response.json();

            const resultDiv = document.getElementById("recommendationResult");
            resultDiv.innerHTML = `
                    <div class="card mb-3 ms-2 mt-2">
                        <img src="${result.image_url}" class="card-img-top" alt="Similar Food">
                        <div class="card-body">
                            <p class="card-text">${result.reason}</p>
                        </div>
                    </div>
                `;
          } catch (error) {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
          }
        });
    </script>
  </body>
</html>
